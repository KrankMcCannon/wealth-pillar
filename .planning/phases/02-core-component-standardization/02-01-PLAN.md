---
phase: 02-core-component-standardization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/modal-wrapper.tsx
  - src/providers/modal-provider.tsx
  - src/lib/navigation/url-state.ts
autonomous: true
requirements: [Task 2.1, Task 2.2, Task 2.3]
must_haves:
  truths:
    - 'ModalProvider uses ModalType strictly for rendering decisions'
    - 'ModalWrapper sub-components (Body, Footer, Section) provide consistent spacing'
    - 'URL state correctly clears editId on modal close'
  artifacts:
    - path: 'src/components/ui/modal-wrapper.tsx'
      provides: 'Standardized ModalBody, ModalFooter, ModalSection'
    - path: 'src/providers/modal-provider.tsx'
      provides: 'Type-safe ModalRenderer'
    - path: 'src/lib/navigation/url-state.ts'
      provides: 'Optimized useModalState with explicit nuqs config'
  key_links:
    - from: 'src/providers/modal-provider.tsx'
      to: 'src/lib/navigation/url-state.ts'
      via: 'useModalState hook'
    - from: 'src/components/ui/modal-wrapper.tsx'
      to: 'shadcn/ui (Dialog/Drawer)'
      via: 'Responsive Dialog pattern'
---

<objective>
Refine the core modal infrastructure to ensure type safety, consistent UI patterns across all features, and optimized URL state management.

Purpose: Eliminate inconsistencies in modal layouts and prevent type-related bugs in the global modal provider.
Output: Refined ModalWrapper, ModalProvider, and url-state utility.
</objective>

<execution_context>
@/Users/ivanapiscitelli/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/ivanapiscitelli/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phase-2/RESEARCH.md
@src/components/ui/modal-wrapper.tsx
@src/providers/modal-provider.tsx
@src/lib/navigation/url-state.ts
</context>

<tasks>

<task type="auto">
  <name>Refine ModalWrapper Sub-components</name>
  <files>src/components/ui/modal-wrapper.tsx</files>
  <action>
    - Standardize `ModalBody`, `ModalFooter`, and `ModalSection` with consistent padding and spacing (using Tailwind variables/classes from Phase 1 where applicable).
    - Ensure `ModalFooter` handles safe area insets for mobile drawers (`pb-[env(safe-area-inset-bottom)]`).
    - Improve accessibility: Ensure `DialogTitle`/`DrawerTitle` and `DialogDescription`/`DrawerDescription` are always present (even if visually hidden for the latter) to satisfy ARIA requirements. 
    - Verify that `aria-describedby` and `aria-labelledby` are correctly associated in both Desktop (Dialog) and Mobile (Drawer) modes.
  </action>
  <verify>Check code for correct ARIA attributes and CSS classes for safe areas.</verify>
  <done>ModalWrapper sub-components are standardized and accessible.</done>
</task>

<task type="auto">
  <name>Standardize ModalProvider & Renderer</name>
  <files>src/providers/modal-provider.tsx</files>
  <action>
    - Refactor `ModalRenderer` to use `ModalType` (from `url-state.ts`) strictly for all conditional rendering.
    - Ensure all feature modals (`TransactionFormModal`, `BudgetFormModal`, etc.) consistently receive `isOpen={true}`, `onClose={closeModal}`, and `editId={editId}` props.
    - Remove hardcoded string checks (`modal === 'transaction'`) in favor of a cleaner mapping or type-safe switch.
  </action>
  <verify>Ensure no lint errors for type mismatches in ModalProvider.</verify>
  <done>ModalProvider is type-safe and consistent.</done>
</task>

<task type="auto">
  <name>Optimize URL State (nuqs)</name>
  <files>src/lib/navigation/url-state.ts</files>
  <action>
    - Update `useModalState` to explicitly configure `nuqs` update behavior.
    - Use `shallow: true` (or the appropriate nuqs v2 equivalent like `withOptions({ shallow: true })`) to avoid unnecessary server-side re-renders when toggling modals.
    - Verify that `closeModal` robustly clears both `modal` and `editId` params.
    - Add documentation comments for `openModal` and `closeModal`.
  </action>
  <verify>Confirm `editId` is cleared in URL when `closeModal` is called.</verify>
  <done>URL state management is optimized and well-documented.</done>
</task>

</tasks>

<verification>
- Run `npm run lint` to check for type safety.
- Verify that `ModalWrapper` sub-components use consistent spacing in the code.
</verification>

<success_criteria>

- `ModalProvider` uses `ModalType` strictly.
- `ModalWrapper` sub-components have standardized spacing and safe-area support.
- URL parameters are correctly cleared on modal close.
  </success_criteria>

<output>
After completion, create `.planning/phases/02-core-component-standardization/02-01-SUMMARY.md`
</output>
